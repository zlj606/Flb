<!DOCTYPE html>
<html>
	<head>
		<title>注册界面</title>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    	<!--[if lt IE 9]>
     		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      		<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    	<![endif]-->
	</head>
	<body>
		<div class="container top-margin">
			<div class="col-xs-12 col-lg-3">
			</div>
			<div class="col-xs-12 col-lg-6">
				<form class="user-register">
					<div class="panel panel-default">
			                <div class="panel-heading">
			                    <h3>注册</h3>
			                </div>
			                <div class="panel-body">
			                    <div class="list-group">
				    				<ul>
			    						<li class="list-group-item">
			    							<label>手机号</label>
			    							<input type="text" class="phone" required>
			    						</li>
			    						<li class="list-group-item">
			    							<label>验证码</label>
			    							<input type="text" class="check-code" required>
			    							<input type="button" class="btn btn-check" value="免费获取验证码">
			    						</li>
			    					</ul>
			    					<button type="button" class="btn btn-success btn-register">注册</button>
				    			</div> 

			                </div>
						</div>
				</form>
			</div>
			<div class="col-xs-12 col-lg-3">
			</div>
		</div>
		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/util.js"></script>
		<script>
			$(function() {
				
				var countdown=60; 
				function settime(val) { 
					if (countdown == 0) { 
							val.attr("disabled", false);	
							val.val("免费获取验证码"); 
							countdown = 60; 
						} else { 
							val.attr("disabled", true); 
							val.val("重新发送(" + countdown + ")"); 
							countdown--; 
						} 
						setTimeout(function() { 
							settime(val) 
						},1000); 
				} 

				function callBack(jData) {
					if("1" != jData.ret) {
						alert("注册失败！");
						return;
					}

					sessionStorage.setItem('user_id', jData.res.uid);
					sessionStorage.setItem('display_name', jData.res.display);

					if (jData.res.jump_url != '') {
                        console.log(jData.res.jump_url);
	    				window.location.href = jData.res.jump_url;

	    			} else {
	    				window.location.href = "index.html";
	    			}
	    			 
				}
				$('.btn-register').on('click', function() {
					var pwd1 = $('.check-code').val(),
					phone = $('.phone').val();
					
					if ('' == pwd1 || '' == phone || false == Util.isPhone(phone)) {
						alert("请输入有效的手机号和验证码");
						return;
					}
					var data = {
						"controller" : "user",
						"action" : "sign",
						"phone" : phone,
						"authnum" : pwd1
					};
					Util.post("index.php", data, callBack);
				});

				function checkCode(jData) {
					if("1" != jData.ret) {
						alert("获取失败！");
						return;
					}

				}
				$('.btn-check').on('click', function() {
					var ph = $('.phone').val();
					if('' == ph || false == Util.isPhone(ph)) {
						alert('请输入有效的手机号');
						return;
					}

					settime($(this));
					Util.get("index.php", {"controller": "user","action" : "send_authnum",
							"phone": ph},checkCode);
				});
				
			});
		</script>
	</body>
</html>
